name: üêõ Debug Build

on:
  pull_request:
    branches: [ master ]
  workflow_dispatch:

jobs:
  debug-build:
    name: üêõ Debug Jekyll Build
    runs-on: ubuntu-latest

    steps:
    - name: üì• Checkout Repository
      uses: actions/checkout@v4

    - name: üèóÔ∏è Setup Ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: '3.3'
        bundler-cache: false

    - name: üìã Environment Info
      run: |
        echo "=== Environment Information ==="
        echo "Ruby version: $(ruby --version)"
        echo "Bundler version: $(bundle --version)"
        echo "Working directory: $(pwd)"
        echo "Files in root:"
        ls -la
        echo ""
        echo "=== Gemfile check ==="
        if [ -f Gemfile ]; then
          echo "‚úÖ Gemfile exists"
          cat Gemfile
        else
          echo "‚ùå Gemfile does not exist"
        fi
        echo ""
        echo "=== _config.yml check ==="
        if [ -f _config.yml ]; then
          echo "‚úÖ _config.yml exists"
          head -20 _config.yml
        else
          echo "‚ùå _config.yml does not exist"
        fi

    - name: üîß Install Dependencies
      run: |
        echo "=== Installing dependencies ==="
        bundle install --verbose
        echo ""
        echo "=== Installed gems ==="
        bundle list

    - name: üèóÔ∏è Jekyll Build Test
      run: |
        echo "=== Jekyll build attempt ==="
        echo "Jekyll version:"
        bundle exec jekyll --version
        echo ""
        echo "Checking for potential issues..."
        echo "Files in root directory:"
        ls -la *.md *.html 2>/dev/null || echo "No .md or .html files in root"
        echo ""
        echo "Checking for duplicate index files:"
        find . -name "index.*" -type f | head -10
        echo ""
        echo "Starting build with maximum verbosity..."
        bundle exec jekyll build --verbose --trace --safe --drafts --future
      env:
        JEKYLL_ENV: development

    - name: üìä Build Results
      if: always()
      run: |
        echo "=== Build Results Check ==="
        if [ -d "_site" ]; then
          echo "‚úÖ _site directory created"
          echo "Files in _site:"
          find _site -type f | head -20
          echo "Total files: $(find _site -type f | wc -l)"
        else
          echo "‚ùå _site directory not created"
        fi

    - name: üîç Error Diagnosis
      if: failure()
      run: |
        echo "=== Error Diagnosis ==="
        echo "Current directory contents:"
        ls -la
        echo ""
        if [ -f "_site" ]; then
          echo "_site exists but might be a file instead of directory"
          file _site
        fi
        echo ""
        echo "Checking for error logs..."
        if [ -f ".jekyll-metadata" ]; then
          echo "Jekyll metadata file exists"
        fi
