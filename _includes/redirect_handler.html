<!--
GitHub Pagesç”¨ é«˜åº¦ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
ä½¿ç”¨æ–¹æ³•: {% include redirect_handler.html %}
-->

<script>
  (function () {
    'use strict';

    // å‹•çš„baseurlå¯¾å¿œ
    const baseUrl = '{{ site.baseurl | default: "" }}';

    // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆæ—§URL â†’ æ–°URLï¼‰
    const redirectMap = {
      // Anthropic ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°
      [`${baseUrl}/documents/_anthropic-prompt-engineering/`]: `${baseUrl}/documents/_anthropic-prompt-engineering/index/`,
      [`${baseUrl}/documents/anthropic-prompt-engineering/`]: `${baseUrl}/documents/_anthropic-prompt-engineering/index/`,

      // Cursor Documentation
      [`${baseUrl}/documents/_cursor/`]: `${baseUrl}/documents/_cursor/index/`,
      [`${baseUrl}/documents/cursor/`]: `${baseUrl}/documents/_cursor/index/`,
      [`${baseUrl}/documents/_cursor/get-started/`]: `${baseUrl}/documents/_cursor/get-started/index/`,
      [`${baseUrl}/documents/_cursor/agent/`]: `${baseUrl}/documents/_cursor/agent/index/`,
      [`${baseUrl}/documents/_cursor/cli/`]: `${baseUrl}/documents/_cursor/cli/index/`,
      [`${baseUrl}/documents/_cursor/cli/reference/`]: `${baseUrl}/documents/_cursor/cli/reference/index/`,
      [`${baseUrl}/documents/_cursor/settings/`]: `${baseUrl}/documents/_cursor/settings/index/`,
      [`${baseUrl}/documents/_cursor/configuration/`]: `${baseUrl}/documents/_cursor/configuration/index/`,
      [`${baseUrl}/documents/_cursor/context/`]: `${baseUrl}/documents/_cursor/context/index/`,
      [`${baseUrl}/documents/_cursor/integrations/`]: `${baseUrl}/documents/_cursor/integrations/index/`,
      [`${baseUrl}/documents/_cursor/tab/`]: `${baseUrl}/documents/_cursor/tab/index/`,
      [`${baseUrl}/documents/_cursor/troubleshooting/`]: `${baseUrl}/documents/_cursor/troubleshooting/index/`,

      // Claude Code Documentation
      [`${baseUrl}/documents/_claude-code/`]: `${baseUrl}/documents/_claude-code/index/`,
      [`${baseUrl}/documents/claude-code/`]: `${baseUrl}/documents/_claude-code/index/`,

      // æ‹¡å¼µå­ä»˜ãURLå¯¾å¿œï¼ˆ.htmlé™¤å»ï¼‰
      [`${baseUrl}/documents/_cursor/agent/overview.html`]: `${baseUrl}/documents/_cursor/agent/overview/`,
      [`${baseUrl}/documents/_cursor/agent/modes.html`]: `${baseUrl}/documents/_cursor/agent/modes/`,
      [`${baseUrl}/documents/_cursor/cli/overview.html`]: `${baseUrl}/documents/_cursor/cli/overview/`,
      [`${baseUrl}/documents/_cursor/get-started/quickstart.html`]: `${baseUrl}/documents/_cursor/get-started/quickstart/`,
      [`${baseUrl}/documents/_cursor/get-started/concepts.html`]: `${baseUrl}/documents/_cursor/get-started/concepts/`,

      // GitHub MCPé–¢é€£
      [`${baseUrl}/documents/github-mcp/`]: `${baseUrl}/documents/github-mcp-index/`,
      [`${baseUrl}/documents/github-mcp-server.html`]: `${baseUrl}/documents/github-mcp-server/`,

      // ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ‘ã‚¹å¯¾å¿œ
      [`${baseUrl}/anthropic/`]: `${baseUrl}/documents/_anthropic-prompt-engineering/index/`,
      [`${baseUrl}/cursor/`]: `${baseUrl}/documents/_cursor/index/`,
      [`${baseUrl}/claude-code/`]: `${baseUrl}/documents/_claude-code/index/`,
      [`${baseUrl}/github-mcp/`]: `${baseUrl}/documents/github-mcp-index/`
    };

    // ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ™ãƒ¼ã‚¹ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆæ­£è¦è¡¨ç¾ï¼‰ - baseurlå¯¾å¿œ
    const escapeRegex = (str) => str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const baseUrlRegex = escapeRegex(baseUrl);

    const patternRedirects = [
      {
        pattern: new RegExp(`^${baseUrlRegex}\\/documents\\/([^\\/]+)\\.html$`),
        replacement: `${baseUrl}/documents/$1/`
      },
      {
        pattern: new RegExp(`^${baseUrlRegex}\\/documents\\/_([^\\/]+)\\/([^\\/]+)\\.html$`),
        replacement: `${baseUrl}/documents/_$1/$2/`
      },
      {
        pattern: new RegExp(`^${baseUrlRegex}\\/documents\\/_([^\\/]+)\\/([^\\/]+)\\/([^\\/]+)\\.html$`),
        replacement: `${baseUrl}/documents/_$1/$2/$3/`
      }
    ];

    // ç¾åœ¨ã®ãƒ‘ã‚¹ã‚’å–å¾—
    const currentPath = window.location.pathname;

    // ç›´æ¥ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ãƒã‚§ãƒƒã‚¯
    if (redirectMap[currentPath]) {
      redirectTo(redirectMap[currentPath], 'exact_match');
      return;
    }

    // ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã‚’ãƒã‚§ãƒƒã‚¯
    for (const redirect of patternRedirects) {
      const match = currentPath.match(redirect.pattern);
      if (match) {
        const newPath = currentPath.replace(redirect.pattern, redirect.replacement);
        redirectTo(newPath, 'pattern_match');
        return;
      }
    }

    // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¢ã‚¯ã‚»ã‚¹ï¼ˆæœ«å°¾ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ãªã—ï¼‰å¯¾å¿œ
    if (!currentPath.endsWith('/') && !currentPath.includes('.')) {
      const dirPath = currentPath + '/';
      if (redirectMap[dirPath]) {
        redirectTo(redirectMap[dirPath], 'directory_redirect');
        return;
      }

      // index/è¿½åŠ ã‚’è©¦è¡Œ
      const indexPath = currentPath + '/index/';
      if (redirectMap[indexPath]) {
        redirectTo(indexPath, 'index_redirect');
        return;
      }
    }

    function redirectTo(newPath, reason) {
      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
      showRedirectNotice(newPath, reason);

      // å±¥æ­´ã«æ®‹ã•ãšãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆSEOé…æ…®ï¼‰
      setTimeout(() => {
        window.location.replace(newPath);
      }, 1500);
    }

    function showRedirectNotice(newPath, reason) {
      const notice = document.createElement('div');
      notice.id = 'redirect-notice';
      notice.style.cssText = `
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      z-index: 10000;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      max-width: 90%;
      text-align: center;
      animation: slideDown 0.3s ease-out;
    `;

      const reasonText = {
        'exact_match': 'ç›´æ¥ãƒãƒƒãƒ',
        'pattern_match': 'ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒ',
        'directory_redirect': 'ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè£œæ­£',
        'index_redirect': 'ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è£œæ­£'
      }[reason] || 'è‡ªå‹•æ¤œå‡º';

      // ã‚»ã‚­ãƒ¥ã‚¢ãªDOMæ§‹ç¯‰ - XSSè„†å¼±æ€§ä¿®æ­£
      const container = document.createElement('div');
      container.style.cssText = 'display: flex; align-items: center; justify-content: center; gap: 10px;';

      const spinner = document.createElement('div');
      spinner.style.cssText = 'width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-top: 2px solid white; border-radius: 50%; animation: spin 1s linear infinite;';

      const textContainer = document.createElement('div');

      const mainText = document.createElement('div');
      mainText.style.fontWeight = '600';
      mainText.textContent = 'ğŸ”„ ãƒšãƒ¼ã‚¸ã‚’æœ€é©åŒ–ã—ã¦ã„ã¾ã™...';

      const metaText = document.createElement('div');
      metaText.style.cssText = 'font-size: 12px; opacity: 0.9; margin-top: 2px;';
      // XSSå¯¾ç­–: textContentã‚’ä½¿ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
      const displayPath = baseUrl ? newPath.replace(baseUrl, '') : newPath;
      metaText.textContent = `ç†ç”±: ${reasonText} | ç§»å‹•å…ˆ: ${displayPath}`;

      textContainer.appendChild(mainText);
      textContainer.appendChild(metaText);
      container.appendChild(spinner);
      container.appendChild(textContainer);
      notice.appendChild(container);

      // CSS ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
      const style = document.createElement('style');
      style.textContent = `
      @keyframes slideDown {
        from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
        to { transform: translateX(-50%) translateY(0); opacity: 1; }
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    `;
      document.head.appendChild(style);
      document.body.appendChild(notice);

      // 3ç§’å¾Œã«é€šçŸ¥ã‚’å‰Šé™¤
      setTimeout(() => {
        if (notice.parentNode) {
          notice.style.animation = 'slideDown 0.3s ease-out reverse';
          setTimeout(() => notice.remove(), 300);
        }
      }, 3000);
    }

    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ï¼‰
    if (window.location.hostname === 'localhost' || window.location.hostname.includes('127.0.0.1')) {
      console.log('[Redirect Handler] Current path:', currentPath);
      console.log('[Redirect Handler] Available redirects:', Object.keys(redirectMap).length);
    }
  })();
</script>

<style>
  /* ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç”¨ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ« */
  .redirect-fallback {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    text-align: center;
    z-index: 10001;
  }

  .redirect-fallback h3 {
    color: #333;
    margin-bottom: 15px;
  }

  .redirect-fallback p {
    color: #666;
    margin-bottom: 20px;
  }

  .redirect-fallback a {
    display: inline-block;
    background: #007bff;
    color: white;
    padding: 10px 20px;
    text-decoration: none;
    border-radius: 5px;
    margin: 0 5px;
  }

  .redirect-fallback a:hover {
    background: #0056b3;
  }
</style>
